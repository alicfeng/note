#### 前言

几乎所有的项目，无论是项目开发的哪一个进度节点上，承载运行项目的环境总是不少于一个，比如`dev`、`test`、`sit`、`uat`、`prod`等环境，这些不同的环境之间几乎都是使用不同的项目配置项，譬如域名地址，支付证书，上传地址等。由此引进项目 **环境配置** 的概念。如下使用`laravel`框架阐述项目配置以及正确使用配置信息 与 环境变量。



#### 问题描述

假如我们有个『CDN 域名』的变量，在 Laravel 中有以下几种方法：

1. 硬代码，直接写死即硬编码。- ❌ 可维护性低
2. 写死在 `config/app.php` 文件中。 - ❌ 无法区分环境进行配置
3. 存储于 `.env` 文件中，使用 `env()` 方法直接读取。 - ❌ 虽然解决了环境变量问题但是不推荐
4. 存储在 `.env` 和 `config/app.php` 文件中，然后使用 `config()` 函数来读取。- ✅ 最佳实践

第一种方法是最古老的方法，代码可维护性极低，一旦域名变更就只能全局替换。

第二种方法无法区分环境，例如本地使用开发环境域名测试，线上才是正式的 CDN 域名。

第三种方法虽然解决了环境变量的问题，并且也具备一定的灵活性，但是不够灵活，假如你的网站流量巨大，需要配置几个 CDN 域名，使其在加载静态资源时随机支配域名，这种做法就无法满足需求了。

第四种方法既支持环境变量，又具备极高的灵活性，假如遇到同样的 CDN 多域名随机问题，你只需要写一个辅助方法，然后在 `config/app.php` 中调用即可，不需要动到任何一行业务逻辑代码。



#### 代码示例

`.env` 文件中设置：

```ini
CDN_DOMAIN=cdndomain.com
```

`config/app.php` 文件中设置：

```php
'cdn_domain' => env('CDN_DOMAIN', null)
```

程序中两种获取 `相同配置` 的方法：

1. `env('CDN_DOMAIN')`
2. `config('app.cdn_domain')`

**注意: 假设程序已经将配置置于缓存之中，此时使用env()的方式读取环境变量是为空的**。

在此统一规定：所有程序配置信息 **必须** 通过 `config()` 来读取，所有的 `.env` 配置信息 **必须** 通过 `config()`来读取，**绝不** 在配置文件以外的范围使用 `env()`。



#### 优势

这样做主要有以下几个优势：

- 定义分明，`config()` 是配置信息，`env()` 只是用来区分不同环境；

- 统一放置于 `config` 中还可以利用框架的配置信息缓存功能来提高运行效率；

- 代码健壮性， `config()` 在 `env()` 之上多出来一个抽象层，会使代码更加健壮，更加灵活。



#### 规范约定

- **除了config目录里使用env()外，在项目的任何代码片段不允许出现env()读取环境变量**
- **因环境 或 项目灵活度情况，必须做到配置化处理**

