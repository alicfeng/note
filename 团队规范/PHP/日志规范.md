#### 前言概述

编写稳定优雅的代码固然重要，而写好日志亦非常重要，无论是何种编程语言，日志信息输出几乎无处不在， 日志是程序员的一把手，属于系统一个重要的组件模块，正确姿势的日志输出，可以帮助我们开发时的调试 与 减轻程序后期的维护压力。

在实际开发中，很多开发者输出日志都是因为程序调试而输出，并没有一个程序全局日志规范输出的习惯，也就是说程序还有很多代码片段需要输出日志的。程序在开发联调的时候，假设程序运行出现异常或者报错，我们第一件事就是查看当时的日志输出，因为日志涵盖了程序运行时的情况信息，可以快速定位到问题的根本原因，生产环境亦是一样。作为开发人员，我们应该重视日志，认识到日志在系统中的地位，更要养成良好日志输出的习惯。

**功能完成开发后，在`review` 自己的代码的时候、务必合理地安排时间将日志填充**



#### 日志输出原则

- 不能影响程序的正常运行
- 不允许输出涉及安全 与 隐私的数据
- 输出有意义的日志信息，同时确保日志的可读性



#### 日志的重要性

- 记载用户行为的审计日志
- 可快速定位问题的根源，日志是排查问题的重要手段之一
- 方便开发调试
- 监控报警
- 查询历史 与 统计分析



#### 认识 `PSR-3` 规范

`PRS-3` 即日志接口规范，日志级别定义了八种，分别如下：

- `info`

  此级别输出任意级别的日志，不推荐使用

- `debug`

  此级别一般用于项目开发调试或测试使用，生产环境决不允许出现 `debug` 级别

- `info`

  此级别用于记录一般行为数据，比如用户行为、`SQL`语句、参数等

- `notice`

  此级别记录程序重要的参数

- `warning`

  此级别记录非错误性的异常 或 非期望的结果

- `error`

  此级别用于记录程序运行时的错误信息，比如程序异常捕获信息

- `critical`

  此级别用于记录程序组件不可用的异常，属于紧急级别，比如某一个微服务通讯失败

- `alert`

  此级别记录程序依赖组建或服务异常，比如`redis`、`MySQL`通讯异常

- `emergency`

  当系统不可用，那就使用此日志级别记录



#### 优雅日志示范

```php
[2019-08-20 23:36:37.310839] local.INFO: push cash {"user_id":9510,"cash":"52.00"}

[2019-08-20 23:36:37.311712] local.DEBUG: source data come from cache 

[2019-08-20 23:36:37.311834] local.NOTICE: sync article successful {"user_id":9510}

[2019-08-20 23:36:37.311935] local.WARNING: logout failed {"user_id":8888}
```



#### 日志输出规范要求

###### 日志结构体

日志输出的信息结构体必须涵盖**日期**、**时间**、**日志级别**、**代码位置**、**日志内容**等信息。

###### 日志内容

日志内容输出规范相当重要，因为日志是给人阅读的，日志内容词语必须是业务相关的专业术语，可以顾名思义，即可以让人一看就清楚知道什么业务的日志，执行到了哪一步，执行的结果是什么，最禁忌的是使用这些日志信息，`==========`、`—————`、`111111111111111`，同时日志的内容尽量保持为英文，防止有时候出现乱码而不能阅读日志( 意想不到的场景、程序还是以英文为准 )，同时禁止输出敏感信息，比如账号密码等。

###### 日志时效性

顾名思义就是日志文件时间的有效性，我们在程序上总会有一种机制，就是设定日志的保留时间，中小型的项目保留时间一般设定为`7~30`天。有时候出现了问题 或 异常，我们并不能即时发现，这时我们就需要追溯到之前的历史日志，因而需要将日志保存一定的时长以便于日志追溯。

###### 日志聚合

- 传统的做法策略：

  我们会有一台日志储存服务器，程序运行的服务器在 `QPS` 最小的时间段将前一天日志同步到日志存储服务器。

- 主流做法：

    使用 `ELK` 即`Elasticsearch`、`Logstash`、`Kibana` 三大组件，分别提供分布式搜索引擎、数据收集处理引擎以及数据缓冲队列，实现全文搜索和分析引擎、提供搜集、分析和存储数据三大功能。合适大型项目构建日志平台，这里不多说~坐好、不发车了。

###### 日志性能

首先明确一点，无论是将日志写于文件还是记录于数据库，都是需要消耗 `IO`资源(`out stream`，主要是写入流)，`IO`操作务必会带了 `CPU` 的抢占与消耗，因而打印日志并不是越多越好，适当合理总是最好的，也就是"日志需要做到平衡膳食"，合理地输出日志有利于提高程序的性能。

注意以下几点：

- 尽量避免在循环体做日志输出，大量日志输出会降低系统性能
- 禁止输出日志内容体日志，比如 `base64` 的图片
- 生产上不允许执行调试级别的日志
- 禁止输出没有意义性的日志



#### 对日志的思考

正确看待日志的重要性，养成合理打印日志信息习惯，请务必对自己的编码 `review` ，检查日志是否满足规范。

































