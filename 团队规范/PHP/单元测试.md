# 单元测试

> TDD是专业人士的选择，它是一项能够提升代码确定性，给程序员激励、降低代码缺陷率、优化文档和设计的原则。对TDD的各项尝试表明，不使用TDD就说明你可能还不够专业。 —— Bob,《程序员的职业素养》

## TDD 开发的基本原则

1. 在编写失败的测试之前，不要编写任何业务代码；
2. 只要有一个单元测试失败了，就不要再些测试代码。无法通过编译也是一种失败情况；
3. 业务代码恰好能够让当前失败的测试成功通过即可，不要多写；
4. 一般而言，当修改已通过的测试时，应该在修改之后（需注释新建的测试）再次测试，确保之前的测试逻辑未被破坏。

## 常用命令

### 新建一个单元测试

```
php artisan make:test ReplyTest --unit
```

### 单独执行某个测试

```
 phpunit tests/Unit/ReplyTest.php
```

### 单独执行某个测试中的函数

```
phpunit --filter a_thread_has_a_creator
```

### 测试案例

```
    public function testExample3()
    {
        $stack = [];    //新建数组$stack，给它一个数组，看看输出的结果是否和我们预期的一致，判断是否一致就要开始断言了~~
        $this->assertEquals(0, count($stack));  //count()提取数组的长度，断言0和数组的长度相等，相等的话测试成功
        array_push($stack, 'foo');              //array_push向数组尾部插入元素'foo'
        $this->assertEquals('foo', $stack[count($stack) - 1]);
        $this->assertEquals(1, count($stack));
        $this->assertEquals('foo', array_pop($stack)); //array_pop()删除数组的最后一个元素，返回值是被删除的元素
        $this->assertEquals(0,count($stack) );  //判断括号内右边的值是否和左边的一致，左边的值是我们的预期输出
    }
```

### 执行结果

![1566134101824](/home/clement/.config/Typora/typora-user-images/1566134101824.png)

> .	成功时输出
> F 运行过程中一个断言失败时输出
> E 运行过程中产生一个错误时输出
> R 被标记为有风险时输出
> S 被跳过时输出
> I 被标记为不完整或未实现时输出
> w 运行过程中产生一个警告

### 常用的PHPunit断言方法

```
assertEquals() 判断是否相等
assertContains()判断输入是否包含指定的值
assertInstanceOf()
assertTrue/assertFalse 断言是否为真值还是假
assertEquals 判断输出是否和预期的相等
assertGreaterThan 断言结果是否大于某个值，同样的也有LessThan 小于
GreaterThanOrEqual 大于等于
LessThanOrEqual 小于等于
assertType 判断是否属于指定类型
assertNull 判断是否为空值
assertFileExists 判断文件是否存在
assertRegExp 根据正则表达式判断
```


